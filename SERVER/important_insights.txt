# מדריך לחקירת תובנות עמוקות - מערכת BI

## מבוא
מסמך זה מיועד למערכת החקירה האוטונומית שמחפשת תובנות עמוקות ולא טריוויאליות.
המטרה: למצוא את ה-"Unknown Unknowns" - מה שהמשתמש לא יודע שהוא לא יודע.

## טבלאות מרכזיות לחקירה

### 1. שורות_מכירה - נתוני מכירות
- תאריך_חשבונית, קוד_לקוח, קוד_פריט, כמות, סכום_אחרי_הנחה
- **חקור**: מגמות, עונתיות, דפוסי קנייה, מוצרים משלימים

### 2. תנועות_יומן - תנועות כספיות
- חשבון, סכום_בשקלים, חובה/זכות, מס._התאמה_פנימית, ת._ערך
- **חקור**: דפוסי תשלום, גידול בחובות, סיכוני אשראי

### 3. שורות_הזמנות_לקוח - הזמנות פתוחות
- הזמנה, סגורה, יתרה_לאספקה, מחיר_בתעודה
- **חקור**: ביטולים, עיכובים, דפוסי הזמנה

### 4. שורות_תעודות_משלוח_החזרה - משלוחים והחזרות
- תאריך, סוג_תעודה, הזמנה, שורה, כמות
- **חקור**: זמני אספקה, אחוזי החזרה, בעיות איכות

### 5. פירוט_הזמנות_רכש - רכש מספקים
- ת._הזמנה, מס_ספק, יתרה_לאספקה, סגורה
- **חקור**: תלות בספקים, עיכובים, ביצועי ספקים

## אסטרטגיות חקירה מתקדמות

### 1. חיפוש אנומליות סטטיסטיות
```sql
-- דוגמה: לקוחות עם דפוס קנייה חריג
WITH customer_stats AS (
  SELECT 
    קוד_לקוח,
    AVG(סכום_אחרי_הנחה) as avg_order,
    STDDEV(סכום_אחרי_הנחה) as std_order,
    COUNT(*) as order_count
  FROM שורות_מכירה
  GROUP BY קוד_לקוח
)
SELECT * FROM customer_stats
WHERE std_order > 2 * avg_order  -- סטיית תקן גבוהה מאוד
```

### 2. זיהוי קורלציות נסתרות
- בדוק קשרים בין: עיכובי ספקים ↔ איבוד לקוחות
- בדוק קשרים בין: תנאי תשלום ↔ נאמנות לקוח
- בדוק קשרים בין: החזרות ↔ הזמנות עתידיות

### 3. ניתוח טמפורלי מתקדם
- חפש מחזוריות נסתרת (לא רק עונתית)
- זהה נקודות מפנה בהתנהגות
- חפש "אירועים" שמשפיעים על דפוסים

### 4. ניתוח רשתות וקשרים
- איזה מוצרים "מושכים" מוצרים אחרים?
- איזה לקוחות משפיעים על לקוחות אחרים?
- איך בעיה אצל ספק אחד משפיעה על כל השרשרת?

## שאלות עמוקות לחקירה

### מכירות ולקוחות:
1. "איזה לקוחות נמצאים בסיכון נטישה בחודשיים הקרובים?"
2. "איזה מוצרים יוצרים את הנאמנות הגבוהה ביותר?"
3. "מה הפרופיל של לקוחות רווחיים לעומת לקוחות מפסידים?"

### תפעול ואספקה:
1. "איך זמני אספקה משפיעים על הזמנות חוזרות?"
2. "איזה דפוסי החזרה מנבאים בעיות איכות?"
3. "מתי כדאי לספק חלקית ומתי לחכות לאספקה מלאה?"

### כספים וסיכונים:
1. "איזה לקוחות מתחילים תהליך של הרעה באשראי?"
2. "מה ההשפעה הכספית האמיתית של איחורי ספקים?"
3. "איפה יש ריכוזיות מסוכנת שלא שמנו לב אליה?"

### הזדמנויות חבויות:
1. "איזה לקוחות קטנים יכולים להפוך לגדולים?"
2. "איזה מוצרים משלימים לא מנוצלים מספיק?"
3. "איפה יש potential לשיפור מרווחים?"

## טכניקות SQL מתקדמות לחקירה

### Window Functions לזיהוי מגמות:
```sql
WITH trend_analysis AS (
  SELECT 
    תאריך_חשבונית,
    SUM(סכום_אחרי_הנחה) OVER (ORDER BY תאריך_חשבונית ROWS BETWEEN 30 PRECEDING AND CURRENT ROW) as rolling_30d,
    LAG(SUM(סכום_אחרי_הנחה), 30) OVER (ORDER BY תאריך_חשבונית) as prev_30d
  FROM שורות_מכירה
)
SELECT * FROM trend_analysis
WHERE rolling_30d < 0.8 * prev_30d  -- ירידה של 20% או יותר
```

### CTEs מורכבים לניתוח רב-שכבתי:
```sql
WITH 
customer_behavior AS (...),
product_performance AS (...),
supplier_reliability AS (...)
SELECT ... -- ניתוח משולב
```

## כללי זהב לחקירה

1. **אל תסתפק בממוצעים** - חפש התפלגויות, חריגים, זנבות
2. **חבר בין דומיינים** - הכי מעניין קורה בחיבורים
3. **חשוב על זמן** - מה קרה לפני? מה יקרה אחרי?
4. **חפש סיבתיות** - לא רק קורלציה
5. **כמת השפעות** - כמה זה שווה בכסף?

## מדדי הצלחה לתובנה טובה

✓ חדשנית - משהו שלא ידענו
✓ פעילה - אפשר לעשות איתה משהו
✓ מדידה - יש לה ערך כספי/כמותי
✓ מבוססת - נתמכת בנתונים חזקים
✓ בהירה - קל להבין ולהסביר

זכור: המטרה היא לגלות את מה שאף אחד לא חשב לחפש!
